# Chapter 2
##### Application Layer

## 2.1.5 P2P 파일 분배

### **P2P 아키텍처 개요**  
섹션 2.1.1에서 설명한 바와 같이, P2P 아키텍처는 항상 켜져 있는 인프라스트럭처 서버에 대한 의존이 최소화(또는 없음)된 구조. 대신, 피어(peer)라고 불리는 간헐적으로 연결된 호스트 쌍이 서로 직접 통신.
피어들은 서비스 제공자에 의해 소유되지 않으며, 사용자가 제어하는 PC, 노트북, 스마트폰으로 구성.

---

### **P2P 아키텍처의 확장성**  

서버와 피어들은 인터넷 접속 링크를 통해 연결.

- **서버의 업로드 속도**: \( u_s \)  
- **\( i \)번째 피어의 업로드 속도**: \( u_i \)  
- **\( i \)번째 피어의 다운로드 속도**: \( d_i \)  
- **분배할 파일 크기 (비트 단위)**: \( F \)  
- **파일 복사본을 얻으려는 피어의 수**: \( N \)  
- **분배 시간**: 모든 \( N \)개의 피어가 파일 복사본을 받는 데 걸리는 시간  

---

### **가정**  
1. 인터넷 코어는 충분한 대역폭을 제공하며, 병목 현상은 접속 네트워크에서 발생.  
2. 서버와 클라이언트는 네트워크의 다른 애플리케이션에 참여하지 않으며, 모든 업로드 및 다운로드 대역폭을 파일 분배에 전용.

---

### **클라이언트-서버 아키텍처**

- 피어는 파일 분배에 도움을 주지 않음.
- 클라이언트-서버 아키텍처의 분배 시간: D(cs) 
- 서버는 각 피어에게 파일을 한 번씩 전송해야 하므로 총 \( NF \) 비트를 전송: NF/u(s)
- 다운로드 속도가 가장 느린 피어의 다운로드 속도를 d(min)이라 할때, 최소 분배 시간: F/d(min)
- 이 피어는 최소한 F/d(min)초가 걸리며, 전체 파일을 받을 수 있음.

---

### **최종 식**  
위 두 가지 관찰을 종합하면, 클라이언트-서버 아키텍처의 최소 분배 시간은 다음과 같음: D(cs) ≧ max{ NF/u(s) , F/d(min)} (식 2.1)
이 식은 클라이언트-서버 아키텍처에서의 **최소 분배 시간**(하한선)을 나타냄.

- 피어의 수 \( N \)이 충분히 큰 경우, 클라이언트-서버 분배 시간은 NF/u(s)로 증가하며, 피어 수 \( N \)에 비례하여 증가.

---

### **P2P 아키텍처**

- 각 피어는 서버의 파일 분배를 도움.
- 피어가 파일 데이터를 받으면, 자신의 업로드 대역폭을 사용하여 다른 피어에게 데이터를 재분배 가능.
- **분배 시작 시점**: 서버만 파일을 보유.  
- **모든 비트를 최소 한 번 전송해야 하는 시간**: F/u(s)
- **최소 분배 시간**: F/d(min)

---

### **시스템 전체 업로드 용량**  
시스템 전체 업로드 용량은 **서버의 업로드 속도**와 **개별 피어들의 업로드 속도 총합**으로 이루어짐:  
u(total) = u(s) + u(1) + ... + u(n)

---

### **최종 식**  
세 가지 관찰을 종합하면, P2P 아키텍처의 최소 분배 시간 \( D_{P2P} \)는 다음과 같음: D(p2p) ≧ max {F/u(s) , F/d(min), NF/u(total)} (식 2.2)

---

### **재분배 방식**  
- 각 피어가 비트를 받자마자 재분배할 수 있다면, 이 하한선을 실제로 달성할 수 있는 재분배 방식이 존재.  
- 그러나 실제로는 개별 비트가 아니라 **파일의 조각**을 재분배하기 때문에, 식 (2.2)는 **실제 최소 분배 시간에 대한 근사치**로 사용됨.

---

### **그림 2.23: 클라이언트-서버와 P2P 아키텍처의 비교**  

![image](https://github.com/user-attachments/assets/e2c327c7-b0e8-4c5d-bcb0-a8b4242307bb)


**클라이언트-서버 아키텍처**:  
- 피어 수가 증가함에 따라 분배 시간이 선형적으로 증가하며 제한이 없음.  

**P2P 아키텍처**:  
- 최소 분배 시간은 클라이언트-서버 아키텍처보다 항상 짧으며, 피어 수에 관계없이 1시간 이내에 분배가 가능.  

P2P 아키텍처를 사용하는 애플리케이션은 **셀프 스케일링(self-scaling)**이 가능함. 이는 **피어가 비트의 소비자일 뿐만 아니라 재분배자 역할**을 하기 때문.

### **BitTorrent**
