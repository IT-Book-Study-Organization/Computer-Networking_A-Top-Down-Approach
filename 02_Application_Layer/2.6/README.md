# Chapter 2
##### Application Layer

### 2.6 비디오 스트리밍과 콘텐츠 전송 네트워크
#### 2.6.1 인터넷 비디오
- 비디오 스트리밍 : 우리가 익히 알고있는 넷플릭스, 유튜브, 아마존 프라임 같은 서비스가 이에 속함
- 비디오 정의 : 그러면 비디오는 뭘까? -> 일정한 속도로 표시되는 이미지의 연속으로 초당 24~30 이미지가 빠르게 바뀌는 것으로 이해할 수 있다. 프레임이라고 표현한다.
- 압축: 우선 비트 레이트 라는 개념을 알아야 하는데 말 그래로 특정 시간 동안 처리하는 비트의 수이다. bps 단위로 처리한다. 압축이라는 말을 들으면 상상되듯이 물체의 속성을 유지하면서 크기를 줄이는 방법이라고 생각할 수 있는데 여기서 압축은 이미지의 용량을 줄여서 품질을 낮추는 것을 말한다. 해상도를 줄인다고 생각하면 편하다. 그레서 압축 -> 크기 작아짐 -> 비트 레이트 작아짐 -> 영상 품질 안좋음 -> 사용자 경험 안좋음
- 비트레이트와 트래픽: 예시를 하나 들 수 있는데 4K 스트리밍(UHD 맞다)의 경우 10Mbps 이상의 비트 레이트를 요구하며 트래픽이 크다.

#### 2.6.2 HTTP 스트리밍과 DASH
- HTTP 스트리밍: 비디오가 HTTP 서버에 우선 파일 형태로 저장이 되면 클라이언트가 서버와 TCP 연결 설정 후 서버의 비디오가 있는 URL에 GET 요청을 하면 비디오를 HTTP 응답으로 보낸다고 생각하면 된다.
- 한 예시를 들어보자 10분 짜리 동영상을 유튜브에서 내 컴퓨터로 스트리밍 한다고 가정하자.
  1) 비디오 세그먼트 : 10분 짜리 동영상을 10초 단위로 잘라서 60개의 세그먼트로 나눈다.(이러면 각각 10초의 세그먼트 이다.)
  2) 클라이언트 요청: 클라이언트(나)가 첫번째 세그먼트에 대해 요청을 보낸다(ex: video_segment_1)를 서버에 요청한다. TCP 소켓을 통해 전송
  3) TCP 연결을 함
  4) 서버가 요청받은 첫 번째 세그먼트에 대해서 HTTP 응답을 클라이언트에게 보냄. TCP 세그먼트로 나누어서 전송됨
  5) 클라이언트의 소켓에는 버퍼가 존재하는데 우선 설명전에 버퍼에 대해서 알아보고 자 한다.
     우선 버퍼의 개념은 TCP 세그먼트를 임시로 저장하는 메모리 공간인데 버퍼를 쓰는 이유는 크게 3가지가 있다
     1) 데이터 전송의 일시적인 비동기성 : 클라이언트가 요청을 보냈을 때 서버가 데이터를 즉시 제공하지 못할 수 있을 때 버퍼거 필요하다
     2) 네트워크 지연 : 네트워크 환경은 이상적이지 않으므로 패킷 손실, 지연, 대역폭 등 변동이 발생할 수 있음
     3) 재성의 연속성 : 클라이언트가 데이터를 실시간으로 재생해야함. 따라서 버퍼가 미리 데이터를 받아와서 재생중에 데이터가 끊기는 것을 방지할 수 있다.
     이를테면 클라이언트 소켓 버퍼가 꽉 차있거나 요청자가 원하는 비트레이트를 충족하는 크기라면 데이터 전송을 시작한다. 클라이언트 소켓 버퍼 -> 클라이언트 애플리케이션
     그리고 버퍼는 수신버퍼와 송신서버가 있는데 이를테면 클라이언트에서는 송신버퍼 : 클라이언트가 보내고자 하는 데이터를 임시로 저장, 수신버퍼: 서버로부터 받은 데이터를 저장

    그니까 정리하면 비동기 개념과 일치하는데 송신할 때는 데이터를 버퍼에 넣어놓고 딴 일을 하고 수신할 때는 데이터를 버퍼에 받아놓고 딴일 하다가 특정 임계치 이상 올라가면 그 세그먼트를 비디오 스트리밍 하는 것이다 .
  6) 버퍼링을 해서 클라이언트(비디오 플레이어) 소켓에 저장함

  7) 충분한 데이터 이를테면(5초)이상 실행시킬 수 있는 충분한 데이터가 생기면 비디오 재생이 시작된다.

  8) 다음 세그먼트 요청

  9) 동적적응해서 대역폭 충분하는 더 높은 비트레이트로 요청함

  10) 계속 재생함.
- DASH 필요성 : HTTP 스트리밍은 전부 다 똑같은 품질의 비디오를 보냄(같은 비트 레이트로 보냄). 모든 클라이언트의 연결상태가 같다면 이상적이겠지만 그렇지않음. 그래서 DASH에서는 여러가지 품질의(비트레이트)로 인코딩함 대역폭 높으면 고화질 비디오, 낮으면 저화질 비디오 이렇게
- 대역폭에 대한 적응성: DASH는 Wi-Fi에서 모바일 데이터로 바꾸면 그거에 맞춰서 비디오 품질 조정
- 매니페스트 파일을 이용해서 각 비디오 품질 버전에 서버에 서로 다른 URL로 저장됨. 파일에는 각 비디오 버전과 비트레이트에 대한 정보가 포함되어 있음.
- 이를테면 클라이언트가 요청할 때
- 1) 클라이언트에 매니페스트 파일을 요청
  2) 매니페스트 파일을 통해 다양한 비디오 버전의 정보를 얻음
  3) 클라이언트는 현재 대역폭을 측정한 후, 가장 적합한 비디오 조각을 선택하여 요청
https://russell-seo.tistory.com/m/18
#### 2.6.3 콘텐츠 전송 네트워크
- CDN의 필요성: 많은 인터넷 비디오 스트리밍 빅 테크등이 수백만 사용자에게 멀티 Mbps 스트림 경험을 제공하기에는 힘들다.
- 그래서 데이터 센터를 전세계에 분산이킨다.
- CDN은 이때 쓰이는 건데 전세계적으로 지리적으로 분산된 위치에서 서버를 관리해서 사용자의 요청을 가장 가까운 CDN으로 유도한다.
- Deep Enter와 Bring Home의 서버 배치 전략이 있는데 Deep Enter는 ISP의 네트워크에 깊숙이 들어서 서버 클러스터를 배치해서 CDN 서버같의 지연과 처리량을 개선하는 것이다.
- Bring Home은 더 작은 수의 사이트에 큰 클러스터를 구축하여 오버해드를 줄이는 대신 지연과 처리량이 높다.
- 콘텐츠 복제 및 요청 처리 : CDN은 클러스터 간의 콘텐츠를 복사함.
