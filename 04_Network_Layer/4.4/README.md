# **4.4 Generalized Forwarding and SDN**

<img width="644" alt="Screenshot 2025-01-23 at 10 26 35 PM" src="https://github.com/user-attachments/assets/f2323430-c24f-404d-a856-89b886c82a32" />

### **1. 일반화된 포워딩의 개념**

일반화된 포워딩은 기존의 목적지 기반 포워딩을 확장한 개념으로, 패킷 처리 방식을 **매치**`match`와 **액션**`action`의 조합으로 정의합니다. 이 방식은 네트워크 프로토콜 스택의 다양한 계층에서 여러 헤더 필드를 기준으로 매치가 이루어지며, 액션은 패킷 전달, 헤더 값 변경, 드롭, 로드 밸런싱 등 다양한 작업을 포함합니다.

- **매치(match):** 프로토콜 스택의 다양한 헤더 필드(예: IP 주소, MAC 주소 등)를 기준으로 패킷을 식별.
- **액션(action):** 매치된 패킷에 대해 수행할 작업(예: 전달, 드롭, 헤더 수정 등).

### **2. 매치-플러스-액션 테이블**

일반화된 포워딩에서 사용되는 **매치-플러스-액션 테이블**은 기존의 목적지 기반 포워딩 테이블을 일반화한 형태로, SDN 컨트롤러가 이를 계산하고 설치 및 업데이트합니다. 이 테이블은 다음과 같은 구성 요소를 포함합니다:

1. **헤더 필드 값 집합:** 수신 패킷이 매치될 값.
2. **카운터 집합:** 매치된 패킷 수, 마지막 업데이트 시간 등을 기록.
3. **액션 집합:** 매치된 패킷에 대해 수행할 작업.

### **3. SDN과 OpenFlow**

**소프트웨어 정의 네트워킹(SDN)**은 네트워크 장비의 데이터 평면과 제어 평면을 분리하여 중앙 집중식 제어를 가능하게 합니다. **OpenFlow**는 SDN에서 일반화된 포워딩을 구현하는 주요 프로토콜로, **플로우 테이블(flow table)**을 통해 매치-플러스-액션 방식을 지원합니다.

#### **SDN의 주요 특징**

- **데이터 평면과 제어 평면 분리:** 스위치는 데이터를 전달하며, 제어는 외부 컨트롤러가 담당.
- **중앙 집중식 제어:** 컨트롤러가 네트워크 전반의 플로우 테이블을 관리.
- **프로그램 가능성:** 네트워크 동작을 소프트웨어적으로 정의.

#### **OpenFlow의 구성 요소**

1. **플로우 테이블:** 패킷 처리 규칙(match+action rules)을 저장.
2. **보안 채널:** 컨트롤러와 스위치 간 통신을 암호화.
3. **OpenFlow 프로토콜:** 플로우 테이블 관리 및 패킷 처리를 위한 명령 전달.

---

### **4.4.1 Match**

<img width="908" alt="Screenshot 2025-01-23 at 10 26 14 PM" src="https://github.com/user-attachments/assets/5195c5bd-6000-47ca-b828-7a2c75a9675c" />

#### **주요 특징**

- OpenFlow 1.0은 11개의 패킷 헤더 필드와 수신 포트 ID를 매치 가능.
- 3개의 프로토콜 헤더 계층(링크, 네트워크, 전송)에서 필드 선택 가능.
- 계층화 원칙을 다소 무시하는 접근 방식.

#### **매치 가능한 주요 필드**

1. 출발지 및 목적지 MAC 주소  
2. 이더넷 타입  
3. VLAN 필드  
4. IP 출발지 및 목적지 주소  
5. IP 프로토콜 필드  
6. IP 서비스 유형 필드  
7. 전송 계층 출발지 및 목적지 포트 번호  
8. 수신 포트 (패킷이 스위치에 들어온 입력 포트)  

#### **플로우 테이블 특성**

- **와일드카드** 사용 가능 (예: 128.119.*.*).  
- 각 항목에 우선순위 부여.  
- 매치되는 항목 중 가장 높은 우선순위의 액션 수행.

#### **매치 필드 선택의 철학**

- 기능성과 복잡성 사이의 균형 추구.
- 추상화의 최소 필수 요소 포착.
- 과도한 일반화 지양.

#### **OpenFlow의 발전**

- OpenFlow 1.0: 12개 매치 가능 값.
- 최근 버전: 41개 매치 가능 값으로 확장.

---

### **4.4.2 Action**

각 플로우 테이블 항목에는 매치된 패킷에 적용될 처리를 결정하는 0개 이상의 **액션 목록**이 있습니다. 여러 액션이 있는 경우, 목록에 지정된 순서대로 수행됩니다.

#### **주요 기능**

1. **포워딩**  
   - 수신 패킷을 특정 물리적 출력 포트로 전달.  
   - 모든 포트로 브로드캐스트 (도착한 포트 제외).  
   - 선택된 포트 집합으로 멀티캐스트.  
   - 패킷을 캡슐화하여 해당 장치의 원격 컨트롤러로 전송.  
     - 컨트롤러는 패킷에 대해 조치를 취하거나 새로운 플로우 테이블 항목을 설치할 수 있음.  
     - 업데이트된 플로우 테이블 규칙에 따라 패킷을 장치로 반환하여 포워딩 가능.  

2. **드롭**  
   - 액션이 없는 플로우 테이블 항목은 매치된 패킷을 드롭해야 함을 나타냄.  

3. **필드 수정**  
   - 10개의 패킷 헤더 필드 값을 재작성할 수 있음.  
   - 선택된 출력 포트로 패킷을 전달하기 전에 수행됨.

---

### **4.4.3 OpenFlow Examples of Match-plus-action in Action**

<img width="651" alt="Screenshot 2025-01-23 at 10 25 36 PM" src="https://github.com/user-attachments/assets/498039d8-8452-494e-b857-e33b0e2a15c4" />

#### **1. 일반화된 포워딩: 매치와 액션의 활용**

- **매치(Match)와 액션(Action)의 개념:**  
  네트워크의 플로우 테이블은 패킷의 헤더 필드(예: IP 주소, 포트, 소스 등)와 수신 포트를 매치하여 적합한 액션(예: 포워딩)을 수행.  
  이를 통해 다양한 네트워크 동작을 논리적으로 구현 가능.

#### **예제 사례**

1. **단순 포워딩(Simple Forwarding):**  
   - 특정 경로를 따라 패킷을 전달.  
   - 예: h5와 h6에서 h3 또는 h4로 전송된 패킷은 s1과 s2를 거치며 특정 링크를 회피.

2. **로드 밸런싱(Load Balancing):**  
   - 동일한 목적지로 가는 패킷을 다중 경로로 분산.  
   - 예: h3와 h4에서 시작된 패킷은 서로 다른 경로를 통해 10.1.*.*로 전달.

3. **방화벽(Firewalling):**  
   - 특정 소스에서 전송된 트래픽만 허용.  
   - 예: s2는 10.3.*.*에서 온 트래픽만 연결된 호스트로 전달.

#### **2. 일반화된 포워딩의 장점과 확장성**

1. **유연성과 확장 가능성:**  
   - 플로우 테이블을 활용하여 가상 네트워크 생성 가능.  
   - 동일한 물리적 네트워크에서 논리적으로 분리된 여러 네트워크를 구현 가능.

2. **고급 프로그래밍 가능성:**  
   - 현재 플로우 테이블은 제한된 형태의 프로그래밍을 제공(헤더 매치 기반 포워딩 및 조작).  
   - **P4 언어:**  
     - 데이터그램 처리를 위한 고급 프로그래밍 언어.  
     - 변수, 연산, 조건문 등을 지원.  
     - 프로토콜 독립적 패킷 처리(Protocol-independent Packet Processing)를 통해 네트워크 프로그래밍 가능성을 확장.  
