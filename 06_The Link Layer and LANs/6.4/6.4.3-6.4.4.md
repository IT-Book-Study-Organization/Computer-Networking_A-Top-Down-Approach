## 6.4.3 링크 계층 스위치
### 스위치의 역할
- 스위치는 링크 계층 프레임을 수신하고 이를 "적절한 출력 링크로 전달하는 장치"임.
- 네트워크의 호스트나 라우터에 대해 투명하게 작동하며, 호스트나 라우터는 스위치에 프레임을 주소 지정하지 않고 다른 호스트나 라우터로 프레임을 전달함.

### 필터링과 전달
- 스위치의 두 가지 주요 기능은 **필터링**과 **전달**임
> 필터링은 **특정 프레임이 어떤 인터페이스로 전달되어야 하는지를 결정**하는 것이다.

> 전달은 **프레임을 특정 인터페이스로 이동시키는 기능**이다.

이런 기능은 **스위치 테이블**을 통해 수행됨.

> **스위치 테이블**은
> - MAC 주소, 해당 MAC 주소로 연결된 스위치 인터페이스, 그리고 해당 항목이 테이블에 추가된 시간을 포함함.

![image](https://github.com/user-attachments/assets/aaabb248-5bfd-487b-bdf1-bf5b662e9392)

이를테면 목적지 주소(MAC 주소)가 DD-DD-DD-DD-DD-DD 인 프레임이 인터페이스 x로 도착하면, 스위치는 다음과 같은 세가지 경우를 처리함.
> 1. 테이블에 항목이 없는 경우: 스위치는 프레임을 모든 인터페이스로 브로드캐스트함.
> 2. 테이블에 인터페이스 x와 연결된 항목이 없는 경우: 스위치는 프레임을 폐기함.
> 3. 테이블에 다른 인터페이스 y와 연결된 항목이 있는 경우: 스위치는 프레임을 인터페이스 y로 전달함.


### 자가 학습 기능
- 스위치는 자가 학습 기능을 통해 테이블을 자동으로 구성함
> 1. 스위치 테이블은 처음에는 비어있음.
> 2. 각 수신 프레임에 대해 스위치는 프레임의 출처 MAC 주소, 프레임이 도착한 인터페이스, 현재 시간을 테이블에 기록.
> 3. 일정 시간이 지나면(노후화 시간), 스위치는 해당 주소가 포함된 프레임을 수신하지 않으면 테이블에서 해당 주소를 삭제함.
![image](https://github.com/user-attachments/assets/643f4a97-9e23-4686-b1ff-30ef9f9d0a1e)

이러한 방식으로, 스위치는 **네트워크 관리자의 개입 없이도 스위치 테이블을 동적으로 구성하고 업데이트** 할 수 있음.
이로 인해 스위치는 **플러그 앤 플레이** 장치로 간주되며, 네트워크 관리자에게 많은 편의를 제공함. 스위치는 또한 **전이 중** 모드로 작동하여 동시에 송신과 수신이 가능해짐.

### 링크 계층 스위치의 장점
> 1. 충돌 제거 : 스위치가 있는 LAN에서는 충돌로 인한 대역폭 낭비가 없음. 스위치는 프레임을 버퍼링하고, 한 세그먼트에서 한 번에 하나의 프레임만 전송함. 이로 인해 스위치는 브로드캐스트 링크가 있는 LAN보다 성능이 크게 좋음.
> 2. 이종 링크 : 스위치는 서로 다른 링크를 격리하여, LAN 내의 링크들이 서로 다른 속도와 매체에서 작동할 수 있게 함. 이를테면 한 스위치가 1 Gbps의 구리 링크와 100 Mbps의 광섬유 링크를 혼합하여 사용할수 있음.
> 3. 관리 용이성 : 스위치는 보안 향상도 좋지만 네트워크 관리에도 도움이됨. 고장난 어뎁터를 감지하고 내부적으로 해당 어댑터를 차단할 수 있음. 또한, 스위치는 대역폭 사용량, 충돌 비율, 트래픽 유형에 대한 통계를 수집하여 네트워크 관리자에게제공할 수 있음.


### 스위치와 라우터의 비교
- 스위치 : **MAC 주소**를 사용하여 패킷을 전달하며, **2계층 패킷 스위치**임, 스위치는 플러그 앤 플레이 기능이 있어 설정이 간편하고, 높은 필러링 및 전달 속도를 제공함. 그러나 스위치 네트워크는 브로드캐스트의 프레임의 순환을 방지하기 위해 스패닝 트리로 제한되며, 브로드캐스트폭풍에 취약함.
- 라우터: **IP 주소**를 사용하여 패킷을 전달하며, **3계층 패킷 스위치**임, 라우터는 계층적 네트워크 주소 체계 사용하여서 패킷이 순환하지 않도록 하며, 여러 경로를 통해 최적의 경로를 사용할 수 있음. 그러나 라우터는 **플러그 앤 플레이**가 아니며, **IP주소 설정**도 필요하고, **패킷 처리 시간이 스위치 보다 더 길 수 있음**
#### 사용 사기
- 소규모 네트워크 : 수백 대의 호스트로 구성된 소규모 네트어크에서는 스위치 만으로만 충분함. 
- 대규모 네트어크 : 수천 대의 호스트가 있는 대규모 네트워크에서는 스위치와 라우터를 함께 사용함.
![image](https://github.com/user-attachments/assets/94b63169-71ef-4023-9fee-3d9cedcfe9f9)

## 6.4.4 가상 로컬 영역 네트워크(VLAN)
- VLAN은 현대 LAN에서 중요한 구성요소로, 여러 개의 가상 로컬 영역 네트워크를 단일 물리적 로컬 영역 네트워크 인프라 위에 정의할 수 있게 해줌.
### VLAN 필요성
> 1. 트래픽 격리 부족: 기존의 계층적 스위치 구성에서는 브로드캐스트 트래픽이 전체 네트웤를 통과해야 하며, 이는 LAN 성능을 저하 시키고 보안 문제 일으킬 수 있음.
> 2.스위치의 비효율적 사용: 많은 그룹이 있을 경우, 각 그룸마다 스위치를 두게 되면 비효율적임. VLAN을 사용하면 하나의 스위치로 여러 그룹을 지원할 수 있음.
> 3. 물리적 케이블을 변경해야하는 경우를, VLAN을 통해 소프트 웨어 적으로 관리 가능

### VLAN의 작동원리
- VLAN을 지원하는 스위치는 여러 개의 가상 네트워크를 정의할 수 있음. **포트 기반 VLAN**의 경우, 네트워크 관리자가 스위치의 포트를 그룹으로 나누어 각 그룹을 VLAN으로 설정함. 각 VLAN은 브로드 캐스트 도메인을 형성하여, 한 포트에서 발생한 브로드캐스트 트래픽은 같은 VLAN에 속한 다른 포트로만 전송됨
- 이를테면 한 스위치의 포트 2에서 8은 EE VLAN에 속하고 포트 9에서 15는 CS VLAN에 속하는 구조를 가질 수 있음.

### VLAN 간 통신
- VLAN간 통신을 위해서는 VLAN의 스위치의 포트를 외부 라우터에 연결하고, 해당 포트를 EE와 CS VLAN 모두에 속하도록 설정할 수 있음.
- EE에서 CS로 가는 IP 데이터 그램은 먼저 EE VLAN을 통해 라우터에 도달한 후, 라우터를 통해 CS VLAN으로 전송됨

### VLAN 트렁킹
- 여러 VLAN을 가진 스위치 간의 연결을 위해 VLAN 트렁킹을 사용할 수 있음. VLAN 간의 프레임을 전송하는 역할을 함.

### VLAN의 정의 방식
> 1. MAC 기반 VLAN: MAC 주소에 따라 VLAN을 지정함.
> 2. 네트워크 계층 프로토콜 기반 VLAN: IPv4, IPv6 등 특정 프로토콜에 따라 VLAN을 정의함
> 3. IP라우터를 통한 VLAN 확장: 여러 LAN을 연결하여 세계적으로 하나의 VLAN을 형성할 수 있음.
