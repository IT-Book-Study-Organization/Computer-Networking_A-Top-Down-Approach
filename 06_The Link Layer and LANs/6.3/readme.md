# 6.3 다중 접속 링크와 프로토콜
네트워크 링크 두가지<BR>
1 점대점 링크 - 한쪽에 단일 송신기가 있고 다른쪽 끝에 단일 수신기가 있음<BR>
  - 많은 링크 계층 프로토콜이 점대점 링크를 위해 설계되었고, 그것은 PPP(점대점 프로토콜)와 HDLC(고급 데이터 링크 제어)이다. <BR>

2 브로드캐스트 링크 - 여러 송신 및 수신 노드가 모두 동일한 단일 공유 브로드캐스트 채널에 연결될 수 있다<BR>
  - 이더넷과 무선 LAN(기업 또는 대학 캠퍼스에 지리적으로 집중된 네트워크)
  
### 다중 접속 프로토콜
노드들이 공유된 브로드캐스트 채널로의 전송을 조절하는 프로토콜. 유선 및 무선 접속 네트워크와 위성 네트워크를 포함한 다양한 네트워크 설정에서 필요함. 

> 모든 노드가 프레임을 전송할 수 있음. 두 개 이상의 노드가 동시에 프레임을 전송할 수 있다. => 모든 노드는 동시에 여러 프레임을 수신하게 됨. **충돌 발생!!!**<BR>
충돌하는 프레임의 신호가 서로 얽혀 수신 노드는 아무것도 이해할 수 없게 된다. 충돌에 관련된 모든 프레임이 손실되고 브로드캐스트 채널이 낭비된다.<BR>
> > **많은 노드가 프레임을 자주 전송하려는 경우 많은 전송이 충돌을 일으키고 브로드캐스트 채널의 대역폭이 낭비된다**

다중 노드가 활성 상태일때 브로드캐스트 채널이 유용한 작업을 수행하도록 하려면 활성 노드의 전송을 조정해야함!! 이 조정작업이 다중 접속 프로토콜의 핵심 책임!!!

여러 연구를 걸쳐 수십개가 구현되었지만 크게 **채널 분할 프로토콜, 랜덤 접속 프로토콜 및 교대 접속 프로토콜**의 세 가지 범주로 분류할 수 있다. 
초당 R 비트의 속도를 가진 브로드캐스트 채널에 대한 다중 접속 프로토콜은 이상적으로 다음과 같은 바람직한 특성을 가져야 한다
> 1. 데이터를 보낼 노드가 하나뿐인 경우 해당 노드는 R bps의 처리량을 가진다
> 2. M개의 노드가 데이터를 보낼 때 이러한 각 노드는 R/M bps의 처리량을 가집니다. 각 노드가 적절하게 정의된 시간 간격에 걸쳐 평균 전송 속도 R/M을 가져야 한다는 의미
> 3. 프로토콜은 분산되어 있습니다. 즉, 네트워크에 대한 단일 실패 지점을 나타내는 마스터 노드가 없다.
> 4. 프로토콜은 간단하여 구현 비용이 저렴하다.

---

## 6.3.1 채널 분할 프로토콜

시간 분할 다중화(TDM)와 주파수 분할 다중화(FDM)는 해당 채널을 공유하는 모든 노드 간에 브로드캐스 채널의 대역폭을 분할하는 데 사용할 수 있는 두 가지 기술

* 시분할(time division): 주어진 시간을 나누어 다수의 사용자에게 그 시간을 분배하여 작업을 가능하게 하는 것

그림 6.9는 간단한 4노드 TDM 예제를 보여준다.
![image](https://github.com/user-attachments/assets/8217a620-1bc8-4dd4-91a4-ac0cb38bce14)
예를 들어 채널이 N개의 노드를 지원하고 채널의 전송 속도가 R bps라고 가정<BR>

TDM은 시간을 시간 프레임으로 나누고 각 시간 프레임을 다시 N개의 시간 슬롯으로 나눕니다<BR>
그런 다음 각 시간 슬롯은 N개의 노드 중 하나에 할당됩니다.<BR>
노드가 보낼 패킷이 있을 때마다 회전하는 TDM 프레임에서 할당된 시간 슬롯 동안 패킷의 비트를 전송합니다.<BR>


TDM으로 규제된 칵테일 파티 비유 - 한 파티 참석자가 고정된 시간동안 말하고 다른 파티 참석자가 동일한 시간동안 말할 수 있도록 허용하고, 이 패턴을 반복함. 

> 장점: TDM은 충돌을 제거하고 공정하기 때문에 매력적임. 각 노드는 프레임 시간동안 R/N bps의 전송 속도를 가짐.
> 
> 단점: 노드는 보낼 패킷이 있는 유일한 노드인 경우에도 평균 R/N bps의 속도로 제한된다. 노드가 항상 전송 순서에서 자신의 차례를 기다려야 한다는 것.

TDM은 시간을 기준으로 브로드캐스트 채널을 공유하는 반면, FDM은 R bps 채널을 서로 다른 주파수(각각 R/N의 대역폭을 가짐)로 나누고 각 주파수를 N개의 노드 중 하나에 할당함

> 따라서  FDM은 단일하고 더 큰 R bps 채널에서 R/N bps의 N개의 더 작은 채널을 만든다.
> FDM은 TDM의 장점과 단점을 모두 공유한다.
>
> 장점: 충돌을 피하고 대역폭을 N개의 노드 간에 공정하게 나눈다.
>
> 단점: 노드는 보낼 패킷이 있는 유일한 노드인 경우에도 대역폭이 R/N으로 제한된다.

세 번째 채널 분할 프로토콜은 CDMA(코드 분할 다중 액세스)
TDM과 FDM이 각각 시간 슬롯과 주파수를 노드에 할당하는 반면, CDMA는 각 노드에 다른 코드를 할당하고 각 노드는 코드를 사용하여 보내는 데이터 비트를 인코딩한다. 코드를 신중하게 선택하면 **CDMA 네트워크는 다른 노드가 동시에 전송하더라도 보낸 사람의 인코딩된 데이터 비트를 올바르게 수신할 수 있는 멋진 속성을 갖는다**
- 군사 시스템, 셀룰러 전화 통신에서 널리 사용되었음

---

## 6.3.2 랜덤 액세스 프로토콜
랜덤 액세스 프로토콜에서 전송 노드는 항상 채널의 전체 속도인 R bps로 전송함. 충돌이 발생하면 각 노드는 프레임(패킷)이 충돌없이 통과할 때까지 프레임을 반복적으로 재전송한다. (즉시는 아님. 노드가 임의의 지연 시간을 선택하여 충돌없이 프레임을 채널에 몰래 넣을 수 있음)

수백 개의 랜덤 액세스 프로토콜이 있는데 여기선 일반적인 ALOHA 프로토콜과 CSMA 프로토콜을 알아보겠음

### 슬롯 ALOHA
가정:
  - 모든 프레임은 정확히 L비트로 구성됨.

  - 시간은 L/R초 크기의 슬롯으로 나뉨(즉, 슬롯은 하나의 프레임을 전송하는 데 걸리는 시간과 같다).

  - 노드는 슬롯 시작 시에만 프레임 전송을 시작함.

  - 노드가 동기화되어 각 노드는 슬롯이 시작되는 시점을 알고 있다.

  - 두 개 이상의 프레임이 슬롯에서 충돌하면 모든 노드는 슬롯이 끝나기 전에 충돌 이벤트를 감지한다.

p를 확률, 즉 0과 1 사이의 숫자로 둡니다. 각 노드에서 슬롯 ALOHA의 작동은 간단하다.

  - 노드에 보낼 새로운 프레임이 있으면 다음 슬롯이 시작될 때까지 기다렸다가 슬롯에서 전체 프레임을 전송함.

  - 충돌이 없으면 노드는 프레임을 성공적으로 전송했으므로 프레임 재전송을 고려할 필요가 없다.

  - 충돌이 있으면 노드는 슬롯이 끝나기 전에 충돌을 감지합니다. 노드는 충돌 없이 프레임이 전송될 때까지 각 후속 슬롯에서 확률 p로 프레임을 재전송한다.


![image](https://github.com/user-attachments/assets/7f5db633-28b0-4ad9-abb1-cd10628b4a05)

그림 6.10 노드 1, 2, 3은 첫 번째 슬롯에서 충돌함. 노드 2는 결국 네 번째 슬롯에서 성공하고, 노드 1은 여덟 번째 슬롯에서, 노드 3은 아홉 번째 슬롯에서 성공함.

#### 확률 p로 재전송한다는 것은 노드가 편향된 동전을 던지는 것과 같다?
앞면 - 재전송에 해당되며, 확률 p로 발생함<BR>
뒷면 - 슬롯을 건너뛰고 다음 슬롯에서 다시 동전을 던지는 것. 확률 1-p로 발생 (프레임을 당장 재전송하지 않고, 다음 슬롯이 될 때까지 기다린 후에 다시 재전송 여부를 결정한다)<BR>
충돌에 관련된 모든 노드는 독립적으로 동전을 던진다.<BR>
> 동전 던지기는 재전송 여부를 결정하는 해우이이고, 확률 p는 각 노드가 얼마나 "적극적"으로 재전송을 시도할지를 결정하는 파라미터

> 장점: 노드가 유일한 활성 노드인 경우 전체 속도 R로 지속적으로 전송 가능. 또한, 매우 분산되어 있음. (재전송을 독립적으로 결정하기때문)

>활성 노드가 하나만 있을때 잘 작동하는 것은 알겠고 활성 노드가 여러 개 있을때도 효율적인지?
두 가지 효율성 문제가 있음. 
1. 활성 노드가 여러 개 있으면 특정 비율의 슬롯에서 충돌이 발생하여 "낭비"됨
2. 확률적 전송 정책의 결과로 모든 활성 노드가 전송을 자제하기 때문에 또 다른 비율의 슬롯이 비어 있게 된다. 
각 노드가 각 충돌 후 즉시 재전송하면 효율성은 0이 된다.

슬롯 ALOHA는 효율성을 0 이상으로 높이지만 얼마나 높일까요?<BR>
가정: 각 노드가 각 슬롯에서 확률 p로 프레임을 전송하려고 시도한다. (각 노드에는 보낼 프레임이 있고 노드는 이미 충돌을 겪은 프레임에 대해서도 확률p로 전송한다) N개의 노드가 있다.

> 성공일 확률: 노드 중 하나가 전송하고 나머지 N-1개의 노드가 전송하지 않을 확률<BR>
주어진 노드가 전송할 확률 p<BR>
나머지 노드가 전송 안 될 확률 (1-p)^(N-1)<BR>
주어진 노드가 성공할 확률 p(1-p)^(N-1)<BR>
>  N개의 노드 중 어느 하나라도 성공할 확률 Np(1-p)^(N-1)<BR>
#### 따라서 N개의 활성 노드가 있을 때 슬롯 ALOHA의 효율성은 Np(1-p)^(N-1)

활성 노드가 많은 경우 최대 효율성을 얻기 위해 N이 무한대로 접근할때 Np(1-p)^(N-1)의 극한을 취한다. 그러면 최대 효율성은 1/e = 0.37로 계산된다.
노드가 많으면 슬롯의 최대 37%만이 유용한 작업을 수행한다는 것. 

#### ALOHA

순수 알로하는 슬롯 ALOHA 분석과 동일한 가정을 하고 프레임 전송 시간을 시간 단위로 간주<BR>
주어진 시간에 노드가 프레임을 전송할 확률은 p<BR>
![image](https://github.com/user-attachments/assets/a6b0fa71-53fb-4985-a2cc-91e487dbf279)
성공하려면 모든 다른 노드가 시간 간격 [t0-1, t0]에서 전송을 하면 안 돼!!!!!!<BR>
모든 다른 노드가 이 간격에서 전송을 시작하지 않을 확률은 (1-p)^(N-1)<BR>
시작과 후반에 겹치면 안 되므로, 취약 시간이 2 단위이므로 다른 N-1개의 노드가 2 단위 시간 동안 전송을 시작하지 않을 확률은 (1-p)^(N-1) * (1-p)^(N-1) = (1-p)^(2(N-1))<BR>
#### 따라서 특정 노드 i가 성공적으로 전송할 확률은 p * (1-p)^(2(N-1))<BR>
극한을 취하면 순수 ALOHA 프로토콜의 최대 효율성은 1/2e에 불과함. 슬롯의 절반임.


#### CSMA (Carrier Sense Multiple Access)
슬롯 ALHOA와 순수 ALOHA의 노드는 전송할대 다른 노드가 전송중인지 따지지않고 보내며, 충돌이 일어난다고해서 중단을 하지도 않음. CSMA는 이렇지 않다!

- 캐리어 감지: 노드는 전송하기 전에 채널을 듣는다. 전송이 감지되지 않을 때까지 기다린 다음 전송을 시작함
- 충돌 감지: 노드는 전송하는 동안 채널을 듣는다. 다른 노드가 전송하고 있으면 전송을 중단하고 유휴상태일때까지 기다림.







