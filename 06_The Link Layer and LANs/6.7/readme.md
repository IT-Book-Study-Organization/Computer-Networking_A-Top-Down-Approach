## 6.7 Retrospective: A Day in the Life of a Web Page Request

**예시 시나리오**:
   - 예시로 **Bob**이라는 학생이 학교의 이더넷 스위치에 연결하여 웹 페이지를 다운로드하는 과정이 설명됨
   - 이 간단한 요청을 처리하는 데 많은 프로토콜들이 작동하며, 이들 간의 상호작용이 이루어짐

---

### 6.7.1 Getting Started: DHCP, UDP, IP, and Ethernet

![image](https://github.com/user-attachments/assets/86bdf293-635c-48b0-afa3-c130f4bbeaa9)

1. **DHCP 요청 생성** :
   - Bob의 랩탑의 운영 체제는 DHCP 요청 메시지를 생성하고 이를 UDP 세그먼트에 넣음. UDP 목적지 포트는 67(서버), 출발지 포트는 68(클라이언트), UDP 세그먼트는 IP 데이터그램 내에 포함되고, IP 목적지 주소는 255.255.255.255로 설정되어 모든 장치로 방송됨. 출발지 IP 주소는 0.0.0.0

2. **이더넷 프레임 생성** :
   - DHCP 요청이 포함된 IP 데이터그램은 이더넷 프레임 내에 넣어져 전송, 이더넷 프레임의 목적지 MAC 주소는 FF:FF:FF:FF:FF:FF로 설정되어 모든 장치로 방송됨, 출발지 MAC 주소는 Bob의 랩탑 MAC 주소(00:16:D3:23:68:8A)입니다.

3. **이더넷 스위치로 전송** :
   - Bob의 랩탑에서 전송된 이더넷 프레임은 첫 번째로 이더넷 스위치로 전송됨
     
4. **라우터에서 프레임 수신** :
   - 라우터는 해당 이더넷 프레임을 수신하고, MAC 주소 00:22:6B:45:1F:1B에 연결된 인터페이스에서 IP 데이터그램을 추출, 데이터그램의 목적지 IP 주소가 방송 주소로 설정되어 있으므로, 상위 계층 프로토콜에서 처리한 이후, UDP 세그먼트가 추출되고, DHCP 요청 메시지가 해석
     
5. **DHCP 응답 생성** :
   - 라우터 내의 DHCP 서버는 68.85.2.0/24 CIDR 블록 내에서 IP 주소를 할당, 68.85.2.101을 Bob의 랩탑에 할당하고, DHCP ACK 메시지를 생성하여 이 IP 주소와 DNS 서버 주소, 기본 게이트웨이 IP 주소 등을 포함

6. **DHCP 응답 전송** :
   - 라우터는 DHCP ACK 메시지가 포함된 이더넷 프레임을 Bob의 랩탑에 전송, 스위치는 이전에 수신한 Bob의 MAC 주소를 기억하고, 해당 MAC 주소가 있는 출력 포트로만 프레임을 전달

7. **Bob의 랩탑에서 수신** :
   - Bob의 랩탑은 DHCP ACK 메시지를 포함한 이더넷 프레임을 수신하고, 그 안의 IP 데이터그램을 추출하여 UDP 세그먼트를 얻고, 다시 DHCP ACK 메시지를 추출, 이후 Bob의 랩탑은 IP 주소와 DNS 서버 주소, 기본 게이트웨이를 기록하고, 기본 게이트웨이 주소를 IP 포워딩 테이블에 설치

---
  
### 6.7.2 Still Getting Started: DNS and ARP

8. **DNS 쿼리 메시지 생성** :
      - Bob의 랩탑은 "www.google.com"을 DNS 쿼리 메시지의 질문 부분에 넣어 생성
      - 이 DNS 메시지는 **UDP 세그먼트**로 감싸지고, 목적지 포트는 53(디폴트 DNS 서버 포트)로 설정됨
      - UDP 세그먼트는 **IP 데이터그램**에 포함되며, 목적지 IP는 DNS 서버의 IP 주소(68.87.71.226), 출발지 IP는 68.85.2.101로 설정됨

9. **이더넷 프레임 생성** :
      - Bob의 랩탑은 DNS 쿼리가 포함된 데이터그램을 **이더넷 프레임**으로 변환하여, 학교 네트워크의 **게이트웨이 라우터**로 전송
      - 하지만 Bob의 랩탑은 게이트웨이 라우터의 MAC 주소를 알지 못해 **ARP 프로토콜**을 사용하여 해당 주소를 찾아야 함

10. **ARP 쿼리 생성** :
      - Bob의 랩탑은 **ARP 쿼리 메시지**를 생성하고, **목표 IP 주소**는 68.85.2.1(기본 게이트웨이)로 설정
      - 이 ARP 메시지는 **브로드캐스트 이더넷 프레임**으로 전송되어, 스위치가 이를 모든 장치에 전달

11. **게이트웨이 라우터의 ARP 응답**:
      - 게이트웨이 라우터는 ARP 쿼리를 수신하고, 자신의 MAC 주소(00:22:6B:45:1F:1B)를 포함한 ARP 응답을 Bob의 랩탑으로 보냄

12. **ARP 응답 수신** :
      - Bob의 랩탑은 ARP 응답을 수신하고, 게이트웨이 라우터의 MAC 주소를 기록함

13. **DNS 쿼리 전송** :
      - 이제 Bob의 랩탑은 DNS 쿼리 메시지를 게이트웨이 라우터의 MAC 주소로 전송.
      - 이더넷 프레임의 목적지 MAC 주소는 00:22:6B:45:1F:1B(게이트웨이 라우터)이고, IP 데이터그램의 목적지 주소는 68.87.71.226(DNS 서버)임
      - Bob의 랩탑은 이 프레임을 스위치로 보내어 게이트웨이 라우터에 전달됨

---

### 6.7.3 Still Getting Started: Intra-Domain Routing to the DNS Server

14. **게이트웨이 라우터에서의 처리** :
      - 게이트웨이 라우터는 DNS 쿼리가 포함된 IP 데이터그램을 수신하고, 목적지 주소(68.87.71.226)를 확인한 후, Comcast 네트워크의 첫 번째 라우터로 전송해야 한다고 판단
      - IP 데이터그램은 적절한 링크 계층 프레임으로 감싸져 해당 라우터로 전송됨

15. **Comcast 네트워크의 첫 번째 라우터에서 처리** :
      - Comcast 네트워크의 첫 번째 라우터는 IP 데이터그램을 수신하고, 목적지 주소(68.87.71.226)를 확인한 후, DNS 서버로 향하는 출력 인터페이스를 찾음
      - 라우터는 이를 위해 내부 도메인 프로토콜(RIP, OSPF, IS-IS)과 BGP를 사용하여 경로를 결정함

16. **DNS 서버에서의 처리** :
      - IP 데이터그램이 DNS 서버에 도달하면, DNS 서버는 쿼리 메시지를 추출하고 www.google.com을 DNS 데이터베이스에서 조회
      - 해당 호스트 이름에 대한 IP 주소(64.233.169.105)를 찾은 후, 이를 포함한 DNS 응답 메시지를 UDP 세그먼트로 만들고, IP 데이터그램으로 Bob의 랩탑(68.85.2.101)으로 전송

17. **Bob의 랩탑에서 IP 주소 추출** :
      - Bob의 랩탑은 DNS 응답에서 www.google.com의 IP 주소를 추출하고, 이제 www.google.com 서버에 접속할 준비가 완료됨

---

### 6.7.4 Web Client-Server Interaction: TCP and HTTP

18. **TCP 소켓 생성 및 3-way 핸드셰이크** :
      - Bob의 랩탑은 www.google.com의 IP 주소를 이용해 TCP 소켓을 생성하고, HTTP GET 메시지를 보냄
      - TCP 소켓을 생성하려면 3-way 핸드셰이크가 필요하며, 이를 위해 TCP SYN 세그먼트를 생성하고, IP 데이터그램과 이더넷 프레임에 넣어 게이트웨이 라우터로 전송

19. **라우터를 통한 TCP SYN 전송** :
      - 학교 네트워크, Comcast 네트워크, Google 네트워크의 라우터들이 TCP SYN 세그먼트를 적절한 경로로 전송

20. **Google 서버에서 TCP SYNACK 수신** :
      - www.google.com에 도달한 TCP SYN 메시지를 처리하여 SYN-ACK 세그먼트를 생성하고, 이를 Bob의 랩탑으로 전송

21. **TCP SYNACK 세그먼트 수신** :
      - SYN-ACK 세그먼트가 Bob의 랩탑에 도달하면, TCP 소켓이 연결 상태로 바뀌고, 이제 Bob의 랩탑은 데이터를 송수신할 준비가 됨

22. **HTTP GET 메시지 전송** :
      - Bob의 웹 브라우저는 HTTP GET 메시지를 생성하고, 이를 TCP 소켓에 작성하여 TCP 세그먼트로 전송. 이 세그먼트는 IP 데이터그램으로 감싸져 Google 서버로 전송됨

23. **HTTP 응답 메시지 생성** :
      - www.google.com 서버는 HTTP GET 메시지를 읽고, 요청된 웹 페이지 콘텐츠를 HTTP 응답 메시지로 생성하여 TCP 소켓을 통해 전송

24. **HTTP 응답 수신 및 웹 페이지 표시** :
      - Bob의 랩탑은 HTTP 응답 메시지를 읽고 HTML 콘텐츠를 추출하여 웹 페이지를 브라우저에 표시
