## 6.6 Data Center Networking

**데이터 센터의 역할** :
   - **콘텐츠 제공** : 웹 페이지, 검색 결과, 이메일, 스트리밍 비디오 등 사용자에게 콘텐츠를 제공
   - **병렬 컴퓨팅** : 대규모 데이터 처리 작업을 위한 분산 인덱스 계산 등 병렬 컴퓨팅 인프라 제공
   - **클라우드 컴퓨팅** : Amazon Web Services, Microsoft Azure, Alibaba Cloud와 같은 클라우드 제공자가 기업의 IT 요구를 처리

## 6.6.1 Data Center Architectures

![image](https://github.com/user-attachments/assets/e37cfc5b-616f-41bf-8aab-5afdab4a1aad)

**흐름** :
  1. 외부 클라이언트의 요청은 경계 라우터를 통해 데이터 센터로 들어옴
  2. 경계 라우터는 이 트래픽을 접근 라우터로 전달하며, 접근 라우터는 로드 밸런서를 사용해 트래픽을 여러 서버로 분배함
  3. 이후 티어 1 스위치를 통해 서버 랙 간에 트래픽이 전달되고, 각 랙의 TOR 스위치가 랙 내 서버들 간의 통신을 관리함
  4. 내부 서버 간의 트래픽은 티어 2 스위치를 통해 처리되며, 최종적으로 서버에서 처리된 데이터는 외부 클라이언트에게 응답으로 전달됨
  5. 이 아키텍처는 데이터 센터 내부의 효율적인 트래픽 관리와 성능 최적화를 지원 

**비용** :
   - 대규모 데이터 센터의 운영 비용은 월 1,200만 달러를 초과할 수 있음
   - 주요 비용 항목:
     - 45%: 호스트 비용 (3-4년마다 교체)
     - 25%: 인프라 비용 (변압기, UPS 시스템, 발전기, 냉각 시스템 등)
     - 15%: 전력 비용
     - 15%: 네트워킹 비용 (네트워크 장비, 외부 링크, 트랜짓 트래픽 등)

**호스트**:
   - 데이터 센터의 호스트는 일반적으로 CPU, 메모리, 디스크 스토리지를 포함하는 범용 호스트인 **블레이드** 형태로 제공.
   - 각 랙에는 20~40개의 블레이드가 포함되어 있으며 랙 상단에는 **Top of Rack (TOR)** 스위치가 배치됨.
   - 각 호스트는 TOR 스위치와 연결되어 있고, TOR 스위치는 다른 스위치와 연결됨

**트래픽 종류**:
   - **외부와 내부 호스트 간 트래픽** : 외부 클라이언트와 내부 호스트 간의 트래픽을 처리하기 위해, 데이터 센터 네트워크에는 하나 이상의 **경계 라우터(Border router)** 가 포함됨
   - **내부 호스트 간 트래픽** : 데이터 센터 네트워크는 랙 간의 트래픽을 처리하고, 이를 경계 라우터에 연결

--- 

### Load Balancing

**Load Balancing** : 애플리케이션을 지원하는 리소스 풀 전체에 네트워크 트래픽을 균등하게 배포하는 방법

- 클라우드 데이터 센터는 외부 클라이언트의 요청을 로드 밸런서를 통해 내부 호스트로 전달
- 로드 밸런서는 요청을 적절한 호스트로 분배하고 부하를 균등하게 조절
- 로드 밸런서는 또한 공용 IP 주소를 내부 호스트의 IP 주소로 변환하여 보안을 강화하고, 클라이언트가 직접 호스트에 접근하지 못하게함

--- 

### Hierarchical Architecture

**데이터 센터 네트워크 계층적 구조** : 
  - **소형 데이터 센터**는 단순한 네트워크 구조(경계 라우터, 로드 밸런서, 몇 개의 랙과 Ethernet 스위치)로 충분함
  - **대규모 데이터 센터**는 수십만 개의 호스트를 지원하기 위해 더 복잡한 계층적 네트워크 구조를 필요로 함
  - **경계 라우터**는 외부와 데이터 센터 간의 연결을 담당하고, **액세스 라우터**는 여러 계층 스위치와 연결됨
  - 네트워크에는 **티어 1 스위치(Tier-1 Switches)**, **티어 2 스위치(Tier-2 Switches)**, **TOR 스위치**가 포함되어 있음

- **부하 분산**: 각 액세스 라우터는 여러 개의 상위 스위치(Tier-1, Tier-2 스위치)와 연결되어 부하를 분산시킴

- **중복성**: 데이터 센터는 고가용성을 유지하기 위해 **중복된 네트워크 장비**와 **링크**를 사용함

- **링크 용량 제한** : 호스트가 같은 랙에 있을 때는 높은 속도의 연결이 가능하지만, 다른 랙 간의 트래픽은 제한된 대역폭으로 인해 성능이 저하될 수 있음

- **해결책** : 
  - **고속 스위치 및 라우터**를 배치하면 성능 향상이 가능하지만, 비용이 급격히 증가함
  - **서비스와 데이터를 물리적으로 가까운 위치에 배치**하여 상호 작용을 최소화하고, **다중 경로 라우팅**을 통해 네트워크 병목 현상을 해결할 수 있음
  - **TOR 스위치와 Tier-2 스위치 간의 연결 증가** : TOR 스위치를 두 개의 Tier-2 스위치에 연결하여 여러 경로를 제공하고, **다중 경로 라우팅(ECMP)** 을 통해 성능과 신뢰성을 향상시킴

![image](https://github.com/user-attachments/assets/3b56d736-d9f9-4e9e-81e6-a82fa36d17d6)

- 이 구조는 **경계 라우터**에서 시작하여 **액세스 라우터**, **티어 1 스위치**, **티어 2 스위치**, 그리고 **TOR 스위치**로 이어짐

- 각 **서버 랙**은 **TOR 스위치**에 연결되며, **TOR 스위치**는 **티어 2 스위치**와 연결되어 상위 계층으로 트래픽을 전달함

- **다중 경로**가 중요한 특징으로, 각 계층은 다양한 **경로**를 통해 서버 간 통신을 최적화함.

- 이 구조는 네트워크 용량을 증가시키고, **경로 다양성**을 통해 **신뢰성**을 향상시키며, 데이터 센터 간 **효율적인 트래픽 분산**을 가능하게 만듬

## 6.6.2 Trends in Data Center Networking

### Cost Reduction

- 인터넷 클라우드 기업들은 데이터 센터의 비용을 줄이고 지연 및 처리 성능을 향상시키며 확장성과 배포 용이성을 개선하기 위해 지속적으로 새로운 데이터 센터 네트워크 설계를 도입하고 있음
- **계층형 네트워크**는 데이터 센터 호스트를 연결하는 중요한 트렌드로, 이는 하나의 매우 큰 크로스바 스위치처럼 작동하며 모든 호스트가 서로 통신할 수 있게 해줌
- **구글의 Jupiter 데이터 센터** : ToR 스위치와 서버 간에 48개의 링크가 연결되고, 8개의 Tier-2 스위치와 연결됨. 각 Tier-2 스위치는 256개의 ToR 스위치와 16개의 Tier-1 스위치와 연결됨.
- **페이스북의 데이터 센터 아키텍처** : 각 ToR 스위치는 4개의 다른 Tier-2 스위치와 연결되고, 각 Tier-2 스위치는 4개의 Tier-1 스위치와 연결됨. 또한, 4개의 스플라인 플레인을 통해 연결됨

### Centralized SDN Control and Management

**SDN(소프트웨어 정의 네트워크, Software-Defined Networking)** : 네트워크의 제어 기능을 중앙에서 소프트웨어로 정의하고 관리하는 방식

- 대규모 데이터 센터에서 **자동화된 구성**과 **운영 상태 관리**는 필수적임
- 자동화는 제어 플레인에서의 복잡한 설정과 관리를 단순화하고, 더욱 효율적인 네트워크 운영을 가능하게 만듬

---

### Virtualization

**가상 머신(VM)** : 애플리케이션 소프트웨어를 물리적 하드웨어에서 분리하여 실행함
   - 이 분리로 인해 VM을 물리적 서버 간에 손쉽게 이동할 수 있음

 - 데이터 센터 네트워크를 **단일, 평면적인 Layer-2 네트워크**로 취급하여 문제를 해결
 - **ARP**는 일반적으로 IP 주소와 MAC 주소를 매핑하는 데 사용되며, 이를 **DNS 스타일의 쿼리 시스템**으로 변경하여 VM의 IP 주소와 현재 연결된 물리적 스위치를 추적함

---

### Physical Constraints

- 데이터 센터 네트워크는 **매우 높은 용량**(40 Gbps, 100 Gbps 링크)과 **매우 낮은 지연**(마이크로초 단위)을 특징으로 함
- 손실 회복과 타임아웃이 발생하면 비효율성이 심각해질 수 있음
- **데이터 센터 전용 TCP 변형** : 데이터 센터에서의 혼잡 제어를 해결하기 위한 여러 가지 TCP 변형이 제안되고 배포됨

### Hardware Modularity and Customization

- 대형 클라우드 제공자는 **네트워크 어댑터, 스위치, 라우터, TOR, 소프트웨어, 네트워킹 프로토콜**을 포함한 데이터 센터 구성 요소를 점점 더 많이 맞춤화하거나 직접 구축함

**가용성 구역(Availability Zones)** :

- **모듈형 데이터 센터**는 표준 12미터 배송 컨테이너를 사용하여 **미니 데이터 센터**를 구축하고 이를 데이터 센터 위치로 배송함
- **아마존**은 **가용성 구역** 개념을 도입하여 **근처 건물에 데이터 센터를 복제**하여 **고장 내성**을 향상시킴
- 가까운 거리에 여러 건물이 위치하여 데이터 센터 간의 트랜잭션 데이터를 동기화하고, 동시에 **내결함성**을 제공함
