## 5.5 SDN 제어 평면

- SDN 제어 평면은 네트워크 전반에 걸쳐 패킷 포워딩을 제어하고 SDN 지원 장치 및 서비스의 구성 및 관리를 담당하는  네트워크 로직임

![image](https://github.com/user-attachments/assets/6d840cbe-3ce8-40a2-916b-0650e05223e1)

#### SDN 아키텍쳐 네 가지 주요 특성은 다음과 같음
-  1. 흐름 기반 포워딩 : SDN  제어 스위치는 전송 계층, 네트워크 계층 또는 링크 계층 헤더의 여러 헤더 필드 값을 기반으로 패킷 포워딩을 수행할 수 있음.
   2. 데이터 평면과 제어 평면의 분리: 데이터 평면은 스위치로 구성되어 있으며, 간단하지만 빠른 장치가 흐름 테이블의 "일치 및 동작" 규칙을 실행함.
   3. 네트워크 제어 기능의 분리 : SDN 제어 평면은 소프트웨어로 구현, 이는 네트워크 스위치와 물리적으로 분리된 서버에서 실행됨.
   4. 프로그래머블 네트워크 : 네트워크 제어 애플리케이션을 통해 네트워크는 프로그래밍 가능합니다.

- 이러한 특징들은 SDN 이 네트워크 기능을 상당히 "분리" 함을 보여줌.

### 5.5.1 SDN 제어 평면: SDN 컨트롤러의 SDN 네트워크 제어 애플리케이션
- SDN 제어 평면은 "SDN 컨트롤러"와 "SDN 네트워크 제어 애플리케이션"으로 이루어짐
#### SDN 컨트롤러
- 1. 통신 계층: SDN 컨트롤러와 제어되는 네트워크 장치 간의 통신을 담당함.
    - SDN 컨트롤러와 원격 SDN 지원 스위치, 호스트 등 다른 장치 제어하려면 프로토콜 필요!!
    - ![image](https://github.com/user-attachments/assets/c9192af2-0768-4f91-a199-bee761645ece)
      
    - 이러한 이벤트는 SDN 컨트롤러에 네트워크 상태에 대한 최신 정보를 제공함.
    - Figure 5.15에서 보여지는 컨트롤러 아키텍쳐의 최하위 계층을 구성함.
    - 이런 통신은 "North interface"라고 불리는 경로를 통해 이루어짐.

- 2. 네트워크 전반의 상태 관리 계층 : SDN 제어 평면에서 이루어지는 궁극적인 제어 결정은 네트워크의 호스트, 링크, 스위치 및 기타 SDN 제어 장치의 상태에 대한 최신 정보를 필요로 함.
- 3. 네트워크 제어 애플리케이션 계층과의 인터페이스: 컨트롤러는 "north interface"를 통해 네트워크 제어 애플리케이션과 상호작용함. 이 API를 통해 상태 관리 계층 내의 네트워크 상태와 흐름 테이블을 읽고 쓸 수 있음. 상태 변경 이벤트가 발생할 때 알림을 받을 수 있도록 등록도 가능.

- 정리하면 "논리적으로 중앙집중화" 된 것으로 간 주 할 수 있음. 하지만 이러한 서비스와 상태 정보를 보유하는 데이터베이스는 실제로는 분산된 서버 집합에 의해 구현되어 신뢰성, 구가용성 또는 성능상의 이유로 운영됨. 예를들면 OpenDaylight의 ONOS가 있음.

### 5.5.2 OpenFlow 프로토콜
SDN 컨트롤러와 OpenFlow API를 구현하는 SDN 제어 스위치 또는 기타 장치 간에 작동. TCP로 작동하며 포트 번호는 6653임.

- SDN 컨트롤러에서 제어된 스위치로 흐르는 주요 메시지는 다음과 같음
  - Configuration: 이 메시지는 컨트롤러가 스위치의 구성 매개변수를 쿼리하고 설정할 수 있도록 함
  - Modify-State: 이 메시지는 컨트롤러가 스위치의 흐름 테이블에 항목을 추가, 삭제 또는 수정하고 스위치 포트 속성을 설정하는 데 사용됨
  - Read-State: 이 메시지는 컨트롤러가 스위치의 흐름 테이블 및 포트에서 통계 및 카운터 값을 수집하는 데 사용됨
  - Send-Packet: 이 메시지는 컨트롤러가 특정 패킷을 제어된 스위치의 지정된 포트에서 전송하는 데 사용됩니다. 메시지 자체는 전송할 패킷을 페이로드로 포함함
- SDN 제어 스위치에서 컨트롤러로 흐르는 메시지는 다음과 같음
  - Flow-Removed: 이 메시지는 흐름 테이블 항목이 제거되었음을 컨트롤러에 알립니다. 예를 들어, 타임아웃 또는 수정 상태 메시지 수신의 결과로 발생할 수 있음.
  - Port-status: 이 메시지는 스위치가 포트 상태의 변경을 컨트롤러에 알리는 데 사용됨
  - Packet-in: 스위치 포트에 도착한 패킷이 흐름 테이블의 어떤 항목과도 일치하지 않을 경우, 해당 패킷은 추가 처리를 위해 컨트롤러로 전송. 일치하는 패킷도 조치의 일환으로 컨트롤러에 전송될 수 있음. Packet-in 메시지는 이러한 패킷을 컨트롤러로 전송하는 데 사용됨

### 5.5.3 데이터 및 제어 평면 상호작용: 예시
- ![image](https://github.com/user-attachments/assets/50da15c5-269b-4b9f-aba1-ee7d5cfb2c67)

- SDN 제어 스위치와 SDN 컨트롤러 간의 상호작용을 이해하기 위해, Dijkstra 알고리즘을 사용하여 최단 경로를 결정하는 예를 살펴봄
- 패킷 스위치는 서로에게 링크 업데이트를 보내지 않고 SDN 컨트롤러에만 전송됨
- Dijkstra 알고리즘은 패킷 스위치 외부의 별도 애플리케이션으로 실행됨

#### 스위치 s1와 s2 간의 링크가 다운된 상황을 가정하자.
- 최단 경로 라우팅이 구현되어 있으며, 이로 인해 s1, s3 및 s4의 수신 및 송신 흐름 포워딩 규칙에 영향을 미침. 하지만 s2의 작동은 변경되지 않음. OpenFlow가 통신 프로토콜로 사용되고, 제어 평면은 링크 상태 라우팅 외에 다른 기능을 수행하지 않는다고 가정하자.
- 1. 링크 상태 변경 알림: 링크 실패를 경험한 스위치 s1은 OpenFlow 포트 상태 메시지를 사용하여 SDN 컨트롤러에 링크 상태 변경을 알림.
  2. 링크 상태 데이터베이스 업데이트: SDN 컨트롤러는 링크 상태 변경을 나타내는 OpenFlow 메시지를 수신하고, 링크 상태 관리자로 알림. 관리자는 링크 상태 데이터베이스를 업데이트함
  3. 링크 상태 변화 알림 수신: Dijkstra의 링크 상태 라우팅을 구현하는 네트워크 제어 애플리케이션은 링크 상태 변경 시 알림을 받도록 사전 등록되어 있음. 해당 애플리케이션은 링크 상태 변경 알림을 수신함.
  4. 최신 링크 상태 가져오기: 링크 상태 라우팅 애플리케이션은 링크 상태 관리자와 상호작용하여 업데이트된 링크 상태를 가져옴. 또한 상태 관리 계층의 다른 구성 요소와 상담할 수도 있음. 그런 다음 새로운 최소 비용 경로를 계산함
  5. 흐름 테이블 업데이트 준비: 링크 상태 라우팅 애플리케이션은 흐름 테이블 관리자와 상호작용하여 업데이트할 흐름 테이블을 결정함
  6. 흐름 테이블 업데이트: 흐름 테이블 관리자는 OpenFlow 프로토콜을 사용하여 영향을 받는 스위치—s1(이제 s2로 가는 패킷을 s4를 통해 라우팅), s2(이제 s1로부터 s4를 통해 패킷을 수신), 및 s4(이제 s1에서 s2로 가는 패킷을 포워딩해야 함)—의 흐름 테이블 항목을 업데이트
##### 이러한 예시는  SDN 제어 평면이 어떻게 제어 평면 서비스를 제공하는지를 보여줌.

### 5.5.4 SDN: 과거와 미래
- SDN(소프트웨어 정의 네트워크)에 대한 관심은 최근에 생긴 현상이지만, 데이터 평면과 제어 평면의 분리 개념은 2004년부터 논의되어 왔음.
- 당시 연구자들은 네트워크의 효율성을 높이기 위해 이러한 분리를 주장했음. 
- Ethane 프로젝트는 단순 흐름 기반 이더넷 스위치와 중앙 집중식 컨트롤러를 통해 패킷을 관리하는 혁신적인 접근 방식을 제시하였고, 이는 나중에 OpenFlow 프로젝트로 발전하였음

- 현재 SDN은 전통적인 모놀리식 스위치와 라우터를 단순한 상용 하드웨어와 정교한 소프트웨어 제어 평면으로 대체하는 혁신적인 변화를 이끌고 있음. 또한, 네트워크 기능 가상화(NFV)는 복잡한 미들박스를 간단한 서버로 대체하는 목표를 가지고 있음.

- 앞으로 SDN은 자율 시스템 간의 연결을 확장하는 연구도 진행 중임. 이러한 발전들은 SDN이 미래의 네트워크 아키텍처와 서비스 제공 방식에 혁신적인 변화를 가져올 것임을 암시함. SDN은 단순한 기술적 변화가 아니라, 네트워크 관리와 운영의 패러다임을 변화시키는 중요한 원칙으로 자리 잡고 있음

### SDN 컨트롤러 사례 연구: OpenDaylight 및 ONOS 컨트롤러
![image](https://github.com/user-attachments/assets/826f0018-c813-4ebf-bd21-ee9686a5c3cf)

#### OpenDaylight 컨트롤러
- OpenDaylight는 네트워크의 기본 기능을 중심으로 구성되어 있으며, 네트워크 전반의 상태 관리 기능과 밀접하게 연결되어 있음.
- 특히 Service Abstraction Layer은 컨트롤러의 핵심으로, 컨트롤러 구성 요소 및 애플리케이션이 서로의 서비스를 호출하고, 구성 및 운영 데이터를 접근하며, 생성한 이벤트에 구독할 수 있게 함.
- ODL은 이 두 가지 방식으로 애플리케이션이 네이티브 컨트롤러 서비스 및 서로 와 상호작용 할수 있도록 함.
- API-Driven 접근 방식에서는 애플리케이션이 HTTP를 통해 REST 요청 - 응답 API로 컨트롤러 모듈과 통신하도록 함
![image](https://github.com/user-attachments/assets/fe684c27-bae0-4d0d-8afa-77e6be7d4022)
#### ONOS 컨트롤러
- 세가지 계층으로 구성됨
- 1. Northbound abstractions and protocols: 애플리케이션이 높은 수준의 서비스를 요청할 수 있게함. 이를테면 호스트 A와 B간의 연결을 설정하거나 통신을 차단 가능
  2. Distributed core: ONOS의 분산 코어는 네트워크의 링크, 호스트 및 장치 상태를 유지함
  3. Southbound abstractions and protocols: 하위 호스트, 링크, 스위치 및 프로토콜의 이질성을 마스킹하여 분산 코어가 장치 및 프로토콜에 구애받지 않도록 함.
