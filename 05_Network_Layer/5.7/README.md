# **5.7 네트워크 관리와 SNMP, NETCONF/YANG**

## **5.7.1 네트워크 관리 프레임워크**

네트워크 관리는 네트워크 관리자들이 네트워크의 상태를 모니터링하고, 구성 및 제어할 수 있도록 돕는 역할을 한다. 네트워크 관리의 주요 구성 요소는 다음과 같다.

### **1. 관리 서버 (Managing Server)**
- 네트워크 운영 센터(NOC)에서 실행되는 중앙 집중식 네트워크 관리 스테이션이다.
- 네트워크 관리자가 개입하여 네트워크 관리 정보를 수집, 처리, 분석 및 배포한다.
- 하나의 네트워크에는 여러 개의 관리 서버가 있을 수 있다.

### **2. 관리 대상 장치 (Managed Device)**
- 네트워크 내의 모든 장비(라우터, 스위치, 호스트 등)가 이에 해당한다.
- 각 장치는 여러 관리 가능한 구성 요소(예: 라우터의 네트워크 인터페이스)를 포함하며, 다양한 설정 매개변수를 가진다.

### **3. 데이터 (Data)**
네트워크 관리에서 다루는 데이터 유형은 다음과 같다.
- **구성 데이터 (Configuration Data)**: 네트워크 관리자가 명시적으로 설정한 정보(예: IP 주소, 인터페이스 속도).
- **운영 데이터 (Operational Data)**: 장치가 작동하면서 얻는 정보(예: OSPF 프로토콜에서 연결된 이웃 목록).
- **장치 통계 (Device Statistics)**: 장치가 운영되는 동안 갱신되는 상태 정보(예: 손실된 패킷 수, 냉각 팬 속도).

### **4. 네트워크 관리 에이전트 (Network Management Agent)**
- 관리 대상 장치에서 실행되는 소프트웨어 프로세스로, 관리 서버와 통신하며 명령을 실행한다.

### **5. 네트워크 관리 프로토콜 (Network Management Protocol)**
- 관리 서버와 관리 대상 장치 간의 데이터를 교환하는 역할을 한다.
- 직접 네트워크를 관리하는 것이 아니라, 네트워크 관리자가 네트워크를 제어할 수 있는 기능을 제공한다.

---

## **5.7.2 네트워크 관리 방법**
네트워크 운영자는 네트워크를 관리하기 위해 주로 세 가지 방법을 사용한다.

### **1. CLI (Command Line Interface)**
- 장치의 CLI를 통해 직접 명령을 입력하여 제어한다.
- Telnet 또는 SSH를 통해 원격으로 명령을 입력할 수도 있다.
- 장치 및 벤더별로 CLI 명령어가 다르므로, 대규모 네트워크 환경에서는 자동화가 어렵다.

### **2. SNMP/MIB (Simple Network Management Protocol / Management Information Base)**
- **SNMP 프로토콜**을 이용하여 관리 장치의 MIB 객체를 조회하거나 설정한다.
- 장치 모니터링에 유용하지만, 대규모 네트워크 관리 및 장치 구성에는 한계가 있다.

### **3. NETCONF/YANG**
- SNMP보다 네트워크 전체의 구성을 중앙에서 관리할 수 있도록 설계되었다.
- **NETCONF**는 장치 간에 구성 데이터를 교환하는 프로토콜이며, **YANG**은 이를 모델링하는 데이터 모델링 언어이다.

---
## **5.7.3 SNMP 및 MIB**

### **SNMP (Simple Network Management Protocol) 개요**
SNMP는 네트워크 관리 서버와 관리 대상 장치 간의 네트워크 관리 정보를 교환하는 애플리케이션 계층 프로토콜이다. 네트워크 관리 서버는 관리 대상 장치에서 데이터를 조회하거나 설정할 수 있으며, 관리 대상 장치는 특정 이벤트가 발생했을 때 서버에 알림을 보낼 수도 있다.

SNMP의 동작 방식은 크게 두 가지로 나뉜다.
1. **요청-응답(request-response) 모델**  
   - 관리 서버가 관리 대상 장치의 MIB 객체를 조회하거나 설정하는 요청을 보냄.
   - 관리 대상 장치는 해당 요청을 수행한 후 응답을 반환.
2. **비동기 트랩(trap) 메시지**  
   - 관리 대상 장치에서 예외적인 이벤트(예: 인터페이스 다운, 과부하 발생)가 발생하면, 이를 관리 서버에 자동으로 알림.

### **SNMP에서 정의된 PDU (Protocol Data Unit) 유형**
SNMPv3에서는 다음과 같은 7가지 PDU 유형이 정의된다.

1. **GetRequest PDU**  
   - 관리 서버가 특정 MIB 객체 값을 요청할 때 사용.

2. **GetNextRequest PDU**  
   - MIB 객체 목록을 순차적으로 검색할 때 사용.
   - 예를 들어, 테이블 형태의 데이터를 순차적으로 조회할 때 유용.

3. **GetBulkRequest PDU**  
   - 여러 개의 MIB 객체 값을 한 번에 요청하여 네트워크 오버헤드를 줄임.

4. **SetRequest PDU**  
   - 관리 서버가 특정 MIB 객체 값을 설정(변경)할 때 사용.

5. **InformRequest PDU**  
   - 한 관리 서버가 다른 관리 서버에 특정 정보를 전달할 때 사용.

6. **Response PDU**  
   - 관리 대상 장치가 관리 서버의 요청에 대한 응답을 반환할 때 사용.

7. **Trap PDU**  
   - 관리 대상 장치에서 비정상적인 이벤트가 발생했을 때 관리 서버에 자동으로 알림을 보냄.

### **SNMP의 요청-응답 모델 및 UDP 기반 통신**
SNMP는 UDP(User Datagram Protocol) 기반으로 동작하는 것이 일반적이다. SNMP 메시지는 UDP 패킷의 페이로드에 포함되어 전송되며, UDP의 특성상 패킷 손실이 발생할 수 있다. 이를 보완하기 위해 SNMP는 다음과 같은 메커니즘을 사용한다.

- **Request ID 필드**  
  - 관리 서버가 요청을 보낼 때 고유한 Request ID를 포함하여 전송.
  - 관리 대상 장치는 응답을 보낼 때 동일한 Request ID를 포함하여 응답.
  - 이를 통해 서버는 응답이 해당 요청과 일치하는지 확인할 수 있음.

- **재전송 정책**  
  - SNMP 자체적으로 재전송을 강제하지 않으며, 재전송 여부는 관리 서버의 구현 방식에 따라 다름.
  - 일반적으로 관리 서버는 일정 시간 내에 응답을 받지 못하면 요청을 다시 보낸다.

### **SNMP의 발전: SNMPv3의 보안 및 관리 기능**
초기 SNMPv1과 SNMPv2는 보안 기능이 부족하여, 관리 서버와 관리 대상 장치 간의 통신이 암호화되지 않았다. 이로 인해 SNMP 메시지가 네트워크에서 가로채질 위험이 있었다. SNMPv3에서는 다음과 같은 보안 기능이 추가되었다.

- **메시지 인증(Authentication)**: 관리 서버와 관리 대상 장치 간의 메시지를 인증하여 신뢰성을 확보.
- **데이터 암호화(Encryption)**: SNMP 메시지를 암호화하여 중간에서 데이터가 유출되는 것을 방지.
- **액세스 제어(Access Control)**: 특정 사용자만 SNMP 데이터를 조회하거나 설정할 수 있도록 권한을 부여.

이러한 보안 기능 덕분에 SNMPv3는 실무에서 더욱 널리 사용되고 있으며, 네트워크 모니터링뿐만 아니라 장치 구성에도 활용된다.

### **MIB (Management Information Base)**
SNMP에서 관리 대상 장치의 상태 정보를 표현하는 데이터베이스가 MIB이다. MIB는 계층적 구조를 가지며, 각 객체는 OID(Object Identifier)로 식별된다.

#### **MIB 객체 예시**
MIB 객체는 다양한 유형의 데이터를 포함할 수 있으며, 몇 가지 주요 예시는 다음과 같다.

- **카운터 값 (Counter32, Counter64)**  
  - 특정 라우터에서 폐기된 IP 데이터그램 수  
  - 네트워크 인터페이스에서 수신한 패킷 수  

- **설명 정보 (String)**  
  - 장치의 소프트웨어 버전  
  - 장치 제조업체 정보  

- **상태 정보 (Boolean or Integer)**  
  - 특정 네트워크 인터페이스의 활성화 여부  
  - 특정 프로토콜이 실행 중인지 여부  

MIB 객체들은 특정한 MIB 모듈에 그룹화되며, 400개 이상의 공식적인 MIB 모듈이 존재한다.

## **5.7.4 NETCONF와 YANG**

### **NETCONF (Network Configuration Protocol)**
NETCONF는 SNMP보다 더 발전된 네트워크 관리 프로토콜로, 주로 장치의 구성(Configuration) 및 운영 상태(Operational State)를 관리하는 데 초점을 맞춘다. XML 기반의 메시지를 사용하며, 보안이 강화된 TCP 기반 세션을 통해 관리 서버와 관리 대상 장치 간의 데이터를 교환한다.

#### **NETCONF의 주요 기능**
1. **구성 데이터 검색, 설정 및 수정**
2. **운영 데이터 및 통계 조회**
3. **장치 알림 구독**

#### **NETCONF의 동작 과정**
1. **관리 서버가 보안 연결을 설정**  
   - TLS 또는 SSH를 이용하여 보안 세션을 확립.
  
2. **서버와 장치가 `<hello>` 메시지를 교환하여 지원 기능을 선언**  
   - 각 장치는 자신이 지원하는 NETCONF 기능을 명시.

3. **XML 기반 `<rpc>` 및 `<rpc-reply>` 메시지를 사용하여 구성 및 운영 데이터를 주고받음**  
   - `<get>`: 장치의 현재 구성 및 상태 정보 요청.  
   - `<edit-config>`: 장치의 설정을 변경.  
   - `<lock>` / `<unlock>`: 특정 장치의 구성을 잠그거나 해제.  

4. **장치에서 알림이 발생하면 `<notification>` 메시지를 관리 서버로 전송**  
   - 예를 들어, 특정 장비에서 장애가 발생하면 즉시 서버에 알림.

5. **세션 종료 시 `<session-close>` 메시지가 사용됨**  

### **NETCONF의 XML 기반 메시지 예제**
#### **1. `<get>` 요청 예제 (장치의 모든 구성 데이터 조회)**  
```xml
<?xml version="1.0" encoding="UTF-8"?>
<rpc message-id="101"
    xmlns="urn:ietf:params:xml:ns:netconf:base:1.0">
  <get/>
</rpc>
```
- **관리 서버에서 장치에 현재 구성 및 상태 데이터를 요청.**
- 장치는 `<rpc-reply>` 메시지를 반환하며, 장치의 모든 구성 데이터를 포함.

#### **2. `<edit-config>` 요청 예제 (Ethernet0/0 인터페이스의 MTU 변경)**  
```xml
<?xml version="1.0" encoding="UTF-8"?>
<rpc message-id="101"
    xmlns="urn:ietf:params:xml:ns:netconf:base:1.0">
  <edit-config>
    <target>
      <running/>
    </target>
    <config>
      <interface>
        <name>Ethernet0/0</name>
        <mtu>1500</mtu>
      </interface>
    </config>
  </edit-config>
</rpc>
```
- **Ethernet0/0 인터페이스의 MTU 값을 1500으로 설정.**
- 장치는 `<ok>` 응답을 반환하여 요청이 성공했음을 알림.

---

### **YANG (Yet Another Next Generation)**
YANG은 NETCONF에서 사용되는 네트워크 관리 데이터를 모델링하는 언어다.

#### **YANG의 주요 특징**
1. **데이터 모델링 언어**: 네트워크 장치의 구성 및 운영 데이터를 구조화하여 정의.
2. **제약 조건 정의**: 구성 데이터의 정확성을 보장하는 규칙을 포함.
3. **NETCONF와 통합 가능**: XML 기반으로 NETCONF에서 사용.

NETCONF와 YANG을 활용하면 대규모 네트워크 환경에서도 효과적으로 장치를 관리할 수 있다.