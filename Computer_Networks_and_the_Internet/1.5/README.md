# 1.5 프로토콜 계층 및 서비스 모델

## 서론

인터넷은 매우 다양한 분야들로 조직되어있다. 이러한 인터넷은 복잡성을 띈다. 복잡성을 고려할 때 네트워크 아키텍처를 조직할 희망이 있는지, 아니면 적어도 네트워크 아키텍처에 대한 논의를 하는것이 어떤지 책은 우리에게 질문을 던졌고, 그렇다라는 답변을 같이 전달했다.

## 계층구조

인터넷 아키텍처에 대한 비유를 항공시스템을 통해서 책은 예시를 들어준다.

항공 시스템은 다음과 같이 구성되어 있다.

+ 티켓 구매 및 확인:

    **출발지** : 티켓을 구매하기

    **도착지** : 도착했을 때 불만 사항이 있을 경우 티켓 창구에서 이를 해결하려고 시도하기

+ 수하물 처리:

    **출발지** : 수하물 맡기기

    **도착지** : 수하물 수령받기

+ 게이트에서 승객 처리:

    **출발지** : 탑승 게이트에서 승객과 수하물을 비행기에 싣기
  
    **도착지** : 게이트에서 내리기

+ 이륙 및 착륙:

    **출발지** : 활주로에서 이륙하기
  
    **도착지** : 활주로에서 착륙하기
  
+ 항공기 라우팅:

    비행 중에 항공 관제 센터를 통해 항공기의 경로를 관리하기


![image](https://github.com/user-attachments/assets/1f99bb86-c3e7-4855-ada3-56107903a6d0)


---  

각각의 기능들을 계층으로 분리하여 서비스를 제공하는 항공 시스템이 예시로 들어졌다. 각 계층은 자신만의 특정 작업을 수행하며, 하위 계층의 서비스를 사용하여 상위 계층에 서비스를 제공한다. 이를 통해 시스템은 모듈화되고, 특정 계층의 구현을 변경해도 전체 시스템의 다른 부분에 영향을 주지 않을 수 있다. 이것이 네트워크 계층의 정의다.

**프로토콜** : 컴퓨터 또는 전자 기기 간의 원활한 통신을 위해 지키기로 약속한 규약

## 프로토콜 계층화

**계층 구조** : 네트워크 프로토콜은 계층(Layer) 구조로 설계되며 각각 고유한 기능들을 가진다.

프로토콜 계층화는 장/단점이 있다.

**장점** : 특정 계층의 구현을 변경해도 다른 계층에 영향을 주지 않음

**단점** : 중복 작업 문제, 정보 공유 문제

---

인터넷 프로토콜 스택(프로토콜의 집합) 계층 구조는 총 5가지로 구성되어있다. (어플리케이션 계층, 전송 계층, 네트워크 계층, 데이터링크 계층, 물리 계층) 계층 별 기능은 다음과 같다.

- **애플리케이션 계층** : HTTP, SMTP 등은 주로 소프트웨어로 구현함

- **전송 계층** : 주로 소프트웨어로 구현함

- **물리 및 데이터 링크 계층** : 특정 링크(Ethernet, WiFi 등)와 관련된 작업을 담당하며, 주로 네트워크 인터페이스 카드에서 구현함

- **네트워크 계층** : 하드웨어와 소프트웨어의 혼합으로 구현함

![image](https://github.com/user-attachments/assets/c329dfc4-879f-4748-8061-59fd91b427ae)

---

**애플리케이션 계층**

응용계층이라고 불리며, 서비스 유형에 따라 프로토콜이 달라진다.

- **웹 서비스** :

    HTTP (예: 웹 브라우징, HTML 문서 가져오기)

- **이메일 서비스** :

    SMTP (예: 이메일 전송)

- **파일 전송 서비스** :

    FTP (예: 클라이언트와 서버 간 파일 전송)

---

**전송 계층**

데이터 전송의 신뢰성을 보장하기 위한 계층으로, 송신 측에서 수신 측으로 패킷이 정상적으로 전달되었는지 확인하는 역할을 수행

책에서는 전송 계층의 패킷을 **세그먼트(segment)** 라고 부름

- **TCP** : 전송 제어 프로토콜

    송신자와 수신자의 속도 조절(흐름 제어)
    네트워크 혼잡 시 전송 속도를 조절(혼잡 제어)

- **UDP** : 사용자 데이터그램 프로토콜

    신뢰성, 흐름 제어, 혼잡 제어 기능 없음
    신속성이 강조되는 서비스에 활용됨

---

**네트워크 계층**

**데이터그램(datagram)** 이라 불리는 네트워크 계층 패킷을 한 호스트에서 다른 호스트로 전달하는 역할

전송 계층(TCP 또는 UDP) 프로토콜은 출발지 호스트에서 전송 계층 세그먼트와 목적지 주소를 네트워크 계층에 전달하여 해당 세그먼트를 목적지 호스트의 전송 계층에 전달하는 서비스를 제공


- **IP 프로토콜** : 인터넷 네트워크 계층의 핵심 프로토콜

    네트워크 계층을 사용하는 모든 인터넷 구성 요소는 IP 프로토콜을 실행해야 함

- **라우팅 프로토콜** : 출발지와 목적지 간 데이터그램의 경로를 결정하는 프로토콜

    다양한 라우팅 프로토콜 사용 가능하며, 각 네트워크 관리자는 원하는 프로토콜을 선택 가능

---

**링크 계층**

책에서는 링크 계층의 패킷을 **프레임(frame)** 이라고 부름

네트워크 계층은 데이터그램을 링크 계층으로 전달하고, 링크 계층은 해당 데이터그램을 경로상의 다음 노드로 전달

- 사용되는 링크 계층 프로토콜에 따라 제공되는 서비스가 다름(Ethernet, WiFi, DOCSIS 등)

- 데이터그램이 여러 링크를 통과할 경우, 각 링크에서 서로 다른 링크 계층 프로토콜(Ethernet, PPP 등)이 사용될 수 있음

---

**물리 계층**

네트워크 장치 간의 물리적 연결을 담당

- 이더넷은 트위스트 페어, 동축 케이블, 광섬유 등 매체에 따라 서로 다른 물리 계층 프로토콜 사용

- 전송 매체에 따라 비트를 전송하는 방식이 다름.

## 캡슐화

원본 정보에 헤더를 붙여나가는 것

![image](https://github.com/user-attachments/assets/bca0847f-0d5e-4441-b915-8e8bf0c1da9e)

![image](https://github.com/user-attachments/assets/374229a5-22db-4ab2-8ba0-053254ebdb39)

**장치의 계층 구현** :

- 호스트: 모든 5개 계층(애플리케이션, 전송, 네트워크, 링크, 물리)을 구현
- 라우터: 1~3계층(물리, 링크, 네트워크) 구현
- 링크 계층 스위치: 1~2계층(물리, 링크) 구현

**캡슐화 과정** :

1. 애플리케이션 계층: 메시지 생성

2. 전송 계층: 메시지에 전송 계층 헤더(HT)를 추가하여 세그먼트(segment) 생성

3. 네트워크 계층: 세그먼트에 네트워크 계층 헤더(HN)를 추가하여 데이터그램(datagram) 생성

4. 링크 계층: 데이터그램에 링크 계층 헤더(HL)를 추가하여 프레임(frame) 생성

5. 각 계층에서 헤더는 상위 계층 데이터를 포함하는 페이로드(payload)를 캡슐화

**전송 과정** :

데이터는 중간 장치(링크 계층 스위치와 라우터)를 통과하며, 각 장치에서 링크 및 네트워크 계층 처리

- 링크 계층 스위치: 링크 계층 헤더(HL)를 기준으로 프레임 전달
  
- 라우터: 네트워크 계층 헤더(HN)를 기준으로 데이터그램 전달

**디캡슐화 과정** :

1. 데이터가 수신 호스트에 도착하면, 물리 계층부터 상위 계층으로 이동하며 각 계층의 헤더가 제거

2. 최종적으로 애플리케이션 계층에서 원래 메시지를 복원
